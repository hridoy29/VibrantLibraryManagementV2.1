@inject IJSRuntime JSRuntime

<div class="interest-alert-title">
    <h3>Interest alerts</h3>
    <p style="margin: 0px;">View all</p>
</div>

<div class="interest-alerts-main-container">
    <div class="blur-wrapper"></div>
    <div class="carousel-interest-alerts" id="carouselContainer">
        @foreach (var item in CarouselItems)
        {
            <div class="carousel-slide">
                <BookCard BookName="@item.Caption" ImageUrl="@item.Image" AlternativeText="@item.AltText" />
            </div>
        }
    </div>

    <button class="prev" @onclick="MovePrev">❮</button>
    <button class="next" @onclick="MoveNext">❯</button>
</div>

<style>
    .blur-wrapper {
        display:none;
        position: absolute;
        left: 100px;
        top: 0px;
        width: 47px;
        height: 100%;
        z-index: 1;
        background: linear-gradient(to right, rgb(255 255 255 / 11%) 13%, rgb(255 255 255 / 112%) 12%, rgb(255 255 255 / 15%) 87%), rgba(255, 255, 255, .7);
        box-shadow: 18px 0 12px -2px rgb(255 255 255 / 74%);
    }

    .interest-alert-title {
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-family: roboto;
        padding: 30px 100px;
    }

    .interest-alerts-main-container {
        height: 390px;
        width: 97vw;
        position: relative;
        padding: 0px 110px;
        box-sizing: border-box;
    }

    .carousel-interest-alerts {
        height: 350px;
        display: flex;
        gap: 20px;
        overflow: hidden;
        scroll-behavior: smooth;
    }

    .carousel-slide {
        width: 185px;
        height: 190px;
        flex-shrink: 0;
    }

    .carousel-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 10px;
    }

    .prev, .next {
        position: absolute;
        top: 35%;
        transform: translateY(-50%);
        background-color: transparent;
        color: white;
        border: none;
        cursor: pointer;
        margin: 10px 90px;
        color: black;
        font-weight: bold;
        font-size: 2em;
    }

    .prev {
        left: 0px;
        z-index: 2;
    }

    .next {
        right: -50px;
        color: lightgray;
    }

    .interest-alert-book-name {
        font-weight: bold;
        padding: 10px 0px;
        padding-bottom: 5px;
        margin: 0px;
        font-family: roboto;
    }

    .autor-interest-alert {
        margin: 0px;
        padding-bottom: 5px;
        font-size: 12px;
    }

    .ratings-interest {
        width: 100px;
    }

    .ratings img{
        width: 12px;
    }

    .ratings-container{
        display: flex;
        align-items: center;
        font-size: 12px;
    }

    @@media only screen and (max-width: 760px) {
        .interest-alerts-main-container, .interest-alert-title {
            padding: 20px;
            width: 96vw;
        }

        .prev, .next {
            margin: 5px 20px;
        }

        .blur-wrapper {
            left: 10px;
        }
    }
</style>

@code {
    public List<CarouselItemModel> CarouselItems = new List<CarouselItemModel>
    {
        new CarouselItemModel { Image = "/images/harry-potter-book-cover.jpg", AltText = "harry", Caption = "Harry Potter" },
        new CarouselItemModel { Image = "/images/lord-of-the-rings-book-cover.jpg", AltText = "lord of the rings", Caption = "Lord of the Rings" },
        new CarouselItemModel { Image = "/images/harry-potter-book-cover.jpg", AltText = "harry", Caption = "Harry Potter" },
        new CarouselItemModel { Image = "/images/lord-of-the-rings-book-cover.jpg", AltText = "lord of the rings", Caption = "Lord of the Rings" },
        new CarouselItemModel { Image = "/images/harry-potter-book-cover.jpg", AltText = "harry", Caption = "Harry Potter" },
        new CarouselItemModel { Image = "/images/lord-of-the-rings-book-cover.jpg", AltText = "lord of the rings", Caption = "Lord of the Rings" },
        new CarouselItemModel { Image = "/images/harry-potter-book-cover.jpg", AltText = "harry", Caption = "Harry Potter" },
        new CarouselItemModel { Image = "/images/lord-of-the-rings-book-cover.jpg", AltText = "lord of the rings", Caption = "Lord of the Rings" },
        new CarouselItemModel { Image = "/images/harry-potter-book-cover.jpg", AltText = "harry", Caption = "Harry Potter" },
        new CarouselItemModel { Image = "/images/lord-of-the-rings-book-cover.jpg", AltText = "lord of the rings", Caption = "Lord of the Rings" },
        new CarouselItemModel { Image = "/images/harry-potter-book-cover.jpg", AltText = "harry", Caption = "Harry Potter" },
        new CarouselItemModel { Image = "/images/lord-of-the-rings-book-cover.jpg", AltText = "lord of the rings", Caption = "Lord of the Rings" },
        new CarouselItemModel { Image = "/images/harry-potter-book-cover.jpg", AltText = "harry", Caption = "Harry Potter" },
        new CarouselItemModel { Image = "/images/lord-of-the-rings-book-cover.jpg", AltText = "lord of the rings", Caption = "Lord of the Rings" },
        new CarouselItemModel { Image = "/images/harry-potter-book-cover.jpg", AltText = "harry", Caption = "Harry Potter" },
        new CarouselItemModel { Image = "/images/lord-of-the-rings-book-cover.jpg", AltText = "lord of the rings", Caption = "Lord of the Rings" },
        new CarouselItemModel { Image = "/images/harry-potter-book-cover.jpg", AltText = "harry", Caption = "Harry Potter" },
        new CarouselItemModel { Image = "/images/lord-of-the-rings-book-cover.jpg", AltText = "lord of the rings", Caption = "Lord of the Rings" },
        new CarouselItemModel { Image = "/images/harry-potter-book-cover.jpg", AltText = "harry", Caption = "Harry Potter" },
        new CarouselItemModel { Image = "/images/lord-of-the-rings-book-cover.jpg", AltText = "lord of the rings", Caption = "Lord of the Rings" },
        new CarouselItemModel { Image = "/images/harry-potter-book-cover.jpg", AltText = "harry", Caption = "Harry Potter" },
        new CarouselItemModel { Image = "/images/lord-of-the-rings-book-cover.jpg", AltText = "lord of the rings", Caption = "Lord of the Rings" },
        new CarouselItemModel { Image = "/images/harry-potter-book-cover.jpg", AltText = "harry", Caption = "Harry Potter" },
        new CarouselItemModel { Image = "/images/lord-of-the-rings-book-cover.jpg", AltText = "lord of the rings", Caption = "Lord of the Rings" },
    };

    public class CarouselItemModel
    {
        public string Image { get; set; }
        public string Caption { get; set; }
        public string AltText { get; set; }
    }

    private async Task MoveNext()
    {
        await JSRuntime.InvokeVoidAsync("moveSlide", 1);
    }

    private async Task MovePrev()
    {
        await JSRuntime.InvokeVoidAsync("moveSlide", -1);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("initializeCarousel");
        }
    }
}

<script>
    let isDragging = false;
    let startX;
    let scrollLeft;

    window.initializeCarousel = function () {
        var carousel = document.getElementById("carouselContainer");

        // Touch event handlers for swiping
        carousel.addEventListener("touchstart", function (e) {
            isDragging = true;
            startX = e.touches[0].pageX;
            scrollLeft = carousel.scrollLeft;
        });

        carousel.addEventListener("touchmove", function (e) {
            if (!isDragging) return;
            let moveX = e.touches[0].pageX - startX;
            carousel.scrollLeft = scrollLeft - moveX;
        });

        carousel.addEventListener("touchend", function () {
            isDragging = false;
        });

        // Mouse event handlers for dragging (desktop)
        carousel.addEventListener("mousedown", function (e) {
            isDragging = true;
            startX = e.pageX;
            scrollLeft = carousel.scrollLeft;
        });

        carousel.addEventListener("mousemove", function (e) {
            if (!isDragging) return;
            let moveX = e.pageX - startX;
            carousel.scrollLeft = scrollLeft - moveX;
        });

        carousel.addEventListener("mouseup", function () {
            isDragging = false;
        });

        // Prevent text selection while dragging
        carousel.addEventListener("dragstart", function (e) {
            e.preventDefault();
        });
    }

    window.moveSlide = function (direction) {
        var carousel = document.getElementById("carouselContainer");
        carousel.scrollLeft += direction * 150;
    }
</script>
