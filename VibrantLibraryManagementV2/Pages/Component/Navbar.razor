@inject NavigationManager _navigate
@inject AuthenticationStateProvider _authenticationStateProvider
@using VibrantLibraryManagementV2.HelperServices
@inject CustomAuthenticationStateProvider _customAuthProviders
@inject IJSRuntime JSRuntime
@inject ILogOutService logoutservices

<head>
    <link rel="stylesheet" href="/css/Navbar.css" />
</head>

<div class="navbar-custom">
    <img src=".././images/VibrantLogoBgRemove.png" class="logo" />
    <div style="display: flex; gap: 40px;">
        <div class="search-box" @onclick="searchBoxClicked">
            <input type="button" value="Search" />
            <img src="/icons/search.png" class="search-icon-navbar" />
        </div>

        <ul class="navbar-ul">
            <li>Home</li>
            <li>Interest</li>
            <li>Topics</li>
            <li>My Loans</li>
            <li>
                <div class="user">
                    <div class="e-avatar e-avatar-small e-avatar-circle image">
                        <img src="/images/user.jpg" style="width: 40px; height: 35px;" />
                    </div>
                    <p style="margin: 0px;">Steven Toh</p>

                    <SfIcon Name="IconName.ChevronDownFill" @onclick="ToggleShowOption"></SfIcon>

                    <div class="options-box" style="display: @(showOption ? "block" : "")">
                        <p>Loans</p>
                        <p>Reservations</p>
                        <p>Interest Profile</p>
                        <button @onclick="LogOut">Log Out</button>
                    </div>
                </div>
            </li>
            <li>
                <ChooseLanguage />
            </li>
        </ul>

    </div>

    <div class="navbar-menu">
        <img src="/icons/search.png" class="search-icon-navbar-mobile" @onclick="searchBoxClicked" />
        <div class="humberger-menu">
            <SfIcon Name="IconName.Menu" @onclick="ShowMobileMenu"></SfIcon>
        </div>
    </div>

    @* Nabar for mobile devices *@
    <ul class="navbar-ul-mobile" style="display: @(showMobileMenu ? "block" : "")">
        <li>Home</li>
        <li>Interest</li>
        <li>Topics</li>
        <li>My Loans</li>
        <li>
            <div class="user">
                <div class="e-avatar e-avatar-xsmall e-avatar-circle image avatar-navbar">
                    <img src="/images/user.jpg" style="width: 25px;  height: 25px;" />
                </div>
                <p style="margin: 0px;">Steven Toh</p>
                <SfIcon Name="IconName.ChevronDownFill" @onclick="ToggleShowOption"></SfIcon>

                <div class="options-box" style="display: @(showOption ? "block" : "")">
                    <p>Loans</p>
                    <p>Reservations</p>
                    <p>Interest Profile</p>
                    <button @onclick="LogOut">Log Out</button>
                </div>
            </div>
        </li>
        <li>
            <ChooseLanguage />
        </li>
    </ul>
</div>

@code {
    public bool showOption { get; set; } = false;
    public bool showMobileMenu { get; set; } = false;
    [Parameter] public EventCallback OnSearchBoxClicked { get; set; }
    private string token;

    private async Task LogOut()
    {
        token = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "authToken");
        var result = await logoutservices.LogOutAsync(token);
        await _customAuthProviders.LogoutAsync();
        _navigate.NavigateTo("/login", forceLoad: true);
    }

    private void ToggleShowOption()
    {
        showOption = !showOption;
    }

    private void ShowMobileMenu()
    {
        showMobileMenu = !showMobileMenu;
    }

    private void searchBoxClicked()
    {
        if (OnSearchBoxClicked.HasDelegate)
        {
            OnSearchBoxClicked.InvokeAsync(null);
        }
    }
}